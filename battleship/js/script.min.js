var view={displayMessage:function(e){document.getElementById("messageArea").innerHTML=e},displayHit:function(e){document.getElementById(e).setAttribute("class","hit")},displayMiss:function(e){document.getElementById(e).setAttribute("class","miss")}},model={boardSize:7,numShips:3,shipLength:3,shipsSunk:0,ships:[{locations:[0,0,0],hits:["","",""]},{locations:[0,0,0],hits:["","",""]},{locations:[0,0,0],hits:["","",""]}],fire:function(e){for(var i=0;i<this.numShips;i++){var s=this.ships[i],t=s.locations.indexOf(e);if(t>=0)return s.hits[t]="hit",view.displayHit(e),view.displayMessage("Якорь вам в глотку!!! Попал!!!"),this.isSunk(s)&&(view.displayMessage("Три тысячи чертей на румбу!!! Палубные крысы разбегаются по шлюпкам!!! Корабль тонет!!!"),this.shipsSunk++),!0}return view.displayMiss(e),view.displayMessage("Чтоб проклятый осьминог выпил весь ром в твоих кишках!!! Всю жизнь будешь палубу драить!!! Мимо!"),!1},isSunk:function(e){for(var i=0;i<this.shipLength;i++)if("hit"!==e.hits[i])return!1;return!0},generateShipLocations:function(){for(var e,i=0;i<this.numShips;i++){do{e=this.generateShip()}while(this.collision(e));this.ships[i].locations=e}},generateShip:function(){var e,i,s=Math.floor(2*Math.random());1===s?(e=Math.floor(Math.random()*this.boardSize),i=Math.floor(Math.random()*(this.boardSize-this.shipLength))):(e=Math.floor(Math.random()*(this.boardSize-this.shipLength)),i=Math.floor(Math.random()*this.boardSize));for(var t=[],n=0;n<this.shipLength;n++)1===s?t.push(e+""+(i+n)):t.push(e+n+""+i);return t},collision:function(e){for(var i=0;i<this.numShips;i++)for(var s=model.ships[i],t=0;t<e.length;t++)if(s.locations.indexOf(e[t])>=0)return!0;return!1}},controller={guesses:0,processGuess:function(e){var i=parseGuess(e);i&&(this.guesses++,model.fire(i)&&model.shipsSunk===model.numShips&&view.displayMessage("Девятый вал валит наповал. Все корабли отправились кормить рыб! Победа!!! Колличество выстрелов "+this.guesses))}};function parseGuess(e){if(null===e||2!==e.length)alert("Или ноль или больше двух");else{var i=["a","b","c","d","e","f","g"].indexOf(e.charAt(0)),s=e.charAt(1);if(isNaN(i)||isNaN(s))alert("Палундра!!! С числами косяк");else{if(!(i<0||i>=model.boardSize||s<0||s>=model.boardSize))return i+s;alert("Нет таких значений")}}return null}function init(){document.getElementById("fireButton").onclick=handleFireButton,document.getElementById("guessInput").onkeypress=handleKeyPress,model.generateShipLocations()}function handleKeyPress(e){var i=document.getElementById("fireButton");if(13===e.keyCode)return i.click(),!1}function handleFireButton(){var e=document.getElementById("guessInput"),i=e.value;controller.processGuess(i),e.value=""}window.onload=init;